<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gd.sakila.mapper.PaymentMapper">
	
	<select id="selectSumPayment" resultType="java.util.Map" parameterType="Integer">
		SELECT 
			MONTH(rental_date) month, 
			COUNT(rental_id) count 
		FROM rental 
		<where>
		 	YEAR(rental_date) = #{year} 
		</where>
		GROUP BY 
			MONTH(rental_date)
	</select>
	
	<!-- 반납시 payment table amount 변경 -->
	<update id="updateAmount" parameterType="java.util.Map">
		UPDATE
			payment
		SET
			amount=#{amount}+#{overdue}
		<where>
			rental_id=#{rentalId}
		</where>
	</update>
	
	<!-- film 대여시 payment table에 입력-->
	<insert id="insertPayment" parameterType="java.util.Map">
		INSERT INTO
			payment(
				customer_id,
				staff_id,
				rental_id,
				amount,
				payment_date
			)VALUES(
				#{customerId},
				#{staffId},
				#{rentalId},
				#{amount},
				NOW()
			)
	</insert>

</mapper>